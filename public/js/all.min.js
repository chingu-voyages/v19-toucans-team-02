let t=null;const e=async e=>{try{console.log("Logging in",e);const o={redirect_uri:window.location.origin};e&&(o.appState={targetUrl:e}),await t.loginWithRedirect(o)}catch(t){console.log("Log in failed",t)}},o=()=>{try{console.log("Logging out"),t.logout({returnTo:window.location.origin})}catch(t){console.log("Log out failed",t)}},a=()=>fetch("/auth_config.json"),i=async()=>{const e=await fetch("/auth_config.json"),o=await e.json();t=await createAuth0Client({domain:o.domain,client_id:o.clientId})},n=async(o,a)=>await t.isAuthenticated()?o():e(a);window.onload=async()=>{await i(),u(window.location.pathname)||(u("/"),window.history.replaceState({url:"/"},{},"/"));document.getElementsByTagName("body")[0].addEventListener("click",t=>{if(g(t.target)){const e=t.target.getAttribute("href");u(e)&&(t.preventDefault(),window.history.pushState({url:e},{},e))}});if(await t.isAuthenticated())return console.log("> User is authenticated"),window.history.replaceState({},document.title,window.location.pathname),void m();console.log("> User not authenticated");const e=window.location.search;if(e.includes("code=")&&e.includes("state=")){console.log("> Parsing redirect");try{const e=await t.handleRedirectCallback();e.appState&&e.appState.targetUrl&&u(e.appState.targetUrl),console.log("Logged in!")}catch(t){console.log("Error parsing redirect:",t)}window.history.replaceState({},document.title,"/")}m()};class l{constructor(t,e,o){this.title=t,this.author=e,this.isbn=o}}class s{static displayBooks(){[{title:"I Robot",author:"Isaac asimov",isbn:"23768"},{title:"Il Sole Nudo",author:"Isaac asimov",isbn:"8439"},{title:"1984",author:"Orwell",isbn:"0982"}].forEach(t=>s.addBookToList(t))}static addBookToList(t){const e=document.querySelector("#book-list"),o=document.createElement("tr");o.innerHTML=`\n        <td>${t.title}</td>\n        <td>${t.author}</td>\n        <td>${t.isbn}</td>\n        <td><a href="#" class="delete">delete</a></td>\n        `,e.appendChild(o)}static clearForm(){document.querySelector("#title").value="",document.querySelector("#author").value="",document.querySelector("#isbn").value=""}static deleteBook(t){t.classList.contains("delete")&&t.parentElement.parentElement.remove()}}class c{static getBooks(){let t;t=null===localStorage.getItem("books")?[]:JSON.parse(localStorage.getItem("books"))}static addBook(t){c.getBooks().push(t)}static removeBook(t){const e=c.getBooks();e.forEach((o,a)=>{o.isbn===t&&e.splice(a,1)}),localStorage.setItem("books",JSON.stringify(e))}}document.addEventListener("DOMContentLoaded",s.displayBooks),document.querySelector("#book-form").addEventListener("submit",t=>{t.preventDefault();const e=document.querySelector("#title").value,o=document.querySelector("#author").value,a=document.querySelector("#isbn").value;if(""===e||""===o||""===a)alert("fields missing");else{const t=new l(e,o,a);console.log(t),s.addBookToList(t),s.clearForm(),c.addBook(t)}}),document.querySelector("#book-list").addEventListener("click",t=>{s.deleteBook(t.target)});const r={"/":()=>h("content-home"),"/profile":()=>n(()=>h("content-profile"),"/profile"),"/login":()=>e()},d=(t,e)=>{for(let o of document.querySelectorAll(t))e(o)},u=t=>!!r[t]&&(r[t](),!0),g=t=>"A"===t.tagName&&t.classList.contains("route-link"),h=t=>{d(".page",t=>t.classList.add("hidden")),document.getElementById(t).classList.remove("hidden")},m=async()=>{try{if(await t.isAuthenticated()){const e=await t.getUser();document.getElementById("profile-data").innerText=JSON.stringify(e,null,2),d(".auth-invisible",t=>t.classList.add("hidden")),d(".auth-visible",t=>t.classList.remove("hidden"))}else d(".auth-invisible",t=>t.classList.remove("hidden")),d(".auth-visible",t=>t.classList.add("hidden"))}catch(t){return void console.log("Error updating UI!",t)}console.log("UI updated")};window.onpopstate=t=>{t.state&&t.state.url&&r[t.state.url]&&u(t.state.url)};